                // Funci√≥n para solicitar permisos y iniciar
        function requestPermissionsAndStart() {
            document.getElementById('loadingText').style.display = 'block';
            document.getElementById('loadingText').textContent = 'Solicitando acceso a la c√°mara...';
            
            // Verificar si estamos en HTTPS o localhost
            if (location.protocol !== 'https:' && location.hostname !== 'localhost') {
                alert('Esta experiencia requiere HTTPS para acceder a la c√°mara. Por favor, usa una conexi√≥n segura.');
                return;
            }
            
            startExperience();
        }<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>ü¶ï La Extinci√≥n de Ad√°n - Experiencia AR</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.7.0/p5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ml5/0.12.2/ml5.min.js"></script>
  <script>
    // Verificar que las librer√≠as se carguen correctamente
    window.addEventListener('load', function() {
        console.log('p5.js disponible:', typeof p5 !== 'undefined');
        console.log('ml5.js disponible:', typeof ml5 !== 'undefined');
    });
</script>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #000;
            font-family: 'Arial', sans-serif;
            overflow: hidden;
        }
        
        #startScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            color: white;
            text-align: center;
        }
        
        #startScreen h1 {
            font-size: 2.5em;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        
        #startScreen p {
            font-size: 1.2em;
            margin-bottom: 40px;
            max-width: 80%;
            line-height: 1.6;
        }
        
        #startBtn {
            background: linear-gradient(45deg, #ff6b6b, #ff8e53);
            border: none;
            padding: 20px 40px;
            font-size: 1.5em;
            font-weight: bold;
            color: white;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        
        #startBtn:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(255, 107, 107, 0.4);
        }
        
        #status {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 14px;
            z-index: 100;
            backdrop-filter: blur(10px);
        }
        
        #instructions {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            text-align: center;
            z-index: 100;
            backdrop-filter: blur(10px);
            font-size: 14px;
        }
        
        .detected {
            background: rgba(0, 255, 0, 0.7) !important;
        }
        
        .meteor-indicator {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 4em;
            color: #ff6b6b;
            z-index: 50;
            animation: pulse 1s ease-in-out infinite;
            pointer-events: none;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 0.5; transform: translate(-50%, -50%) scale(1); }
            50% { opacity: 1; transform: translate(-50%, -50%) scale(1.2); }
        }
        
        #loadingText {
            margin-top: 20px;
            font-size: 1em;
            opacity: 0.8;
        }
    </style>
</head>
<body>
    <div id="startScreen">
        <h1>La Extinci√≥n de Ad√°n</h1>
        <p>Una experiencia de Realidad Aumentada que recrea el momento donde la creaci√≥n divina se encuentra con la destrucci√≥n c√≥smica. Enfoca la obra de arte para presenciar el apocalipsis que une el g√©nesis con el final.</p>
        <div style="margin-top: 30px; font-style: italic; opacity: 0.9; font-size: 1.1em;">‚Äî Pocho</div>
        <button id="startBtn" onclick="requestPermissionsAndStart()">Iniciar Experiencia AR</button>
        <div id="loadingText" style="display: none;">Cargando modelo de IA...</div>
    </div>
    
    <div id="status">üîç Buscando obra de arte...</div>
            <div id="instructions">Apunta la c√°mara hacia "La Extinci√≥n de Ad√°n"</div>
    
    <script>
        // Variables globales
        let video;
        let classifier;
        let label = "Buscando...";
        let confidence = 0;
        let meteorites = [];
        let isDetected = false;
        let isModelLoaded = false;
        let apocalypseStarted = false;
        let meteoritePng;
        let startTime;
        
        // Estados de la experiencia
        let experienceStarted = false;
        let explosions = [];
        
        function preload() {
            // Crear un meteorito simple como PNG
            meteoritePng = createGraphics(30, 30);
            meteoritePng.fill(255, 100, 0);
            meteoritePng.noStroke();
            meteoritePng.ellipse(15, 15, 20, 20);
            meteoritePng.fill(255, 200, 0);
            meteoritePng.ellipse(15, 15, 12, 12);
        }
        
        // Funci√≥n para solicitar permisos y iniciar
        function requestPermissionsAndStart() {
            document.getElementById('loadingText').style.display = 'block';
            document.getElementById('loadingText').textContent = 'Solicitando acceso a la c√°mara...';
            
            // Verificar si estamos en HTTPS o localhost
            if (location.protocol !== 'https:' && location.hostname !== 'localhost') {
                alert('Esta experiencia requiere HTTPS para acceder a la c√°mara. Por favor, usa una conexi√≥n segura.');
                return;
            }
            
            startExperience();
        }
        
        function setup() {
            createCanvas(windowWidth, windowHeight);
            
            // AQU√ç COLOCAS TU MODELO ENTRENADO DE TEACHABLE MACHINE
// Reemplaza con tu URL cuando tengas el modelo listo:
const modelURL = 'https://LaPocho.github.io/la-extincion-de-adan/';

// Verificar si ml5 est√° disponible antes de usarlo
if (typeof ml5 !== 'undefined') {
    console.log('ml5.js cargado correctamente');
    // Descomentar cuando tengas el modelo:
    // classifier = ml5.imageClassifier(modelURL + 'model.json', modelReady);
} else {
    console.log('ml5.js no disponible, usando simulaci√≥n');
}

// Para desarrollo, usamos detecci√≥n simulada
setTimeout(() => {
    isModelLoaded = true;
    document.getElementById('loadingText').textContent = 'Sistema listo ‚úì';
}, 2000);
        }
        
        // Funci√≥n que se ejecuta cuando el modelo est√© listo (para el futuro)
        function modelReady() {
            isModelLoaded = true;
            document.getElementById('loadingText').textContent = 'Modelo de IA cargado ‚úì';
            console.log('Modelo listo para usar');
        }
        
        function startExperience() {
            experienceStarted = true;
            document.getElementById('startScreen').style.display = 'none';
            
            // Inicializar c√°mara con fallback para m√≥viles
            let constraints = {
                video: {
                    facingMode: "environment",
                    width: { ideal: 1280 },
                    height: { ideal: 720 }
                },
                audio: false
            };
             navigator.mediaDevices.getUserMedia(constraints)
                .then(function(stream) {
                    console.log('C√°mara trasera obtenida');
                    setupVideoStream(stream);
                })
                .catch(function(err) {
                    console.log('Error con c√°mara trasera:', err);
                    // Fallback: intentar con cualquier c√°mara
                    return navigator.mediaDevices.getUserMedia({
                        video: true,
                        audio: false
                    });
                })
                .then(function(stream) {
                    if (stream) {
                        console.log('C√°mara alternativa obtenida');
                        setupVideoStream(stream);
                    }
                })
                .catch(function(err) {
                    console.log('Error total con c√°mara:', err);
                    alert('No se pudo acceder a la c√°mara. Verifica los permisos y que est√©s usando HTTPS.');
                    document.getElementById('loadingText').textContent = 'Error: No se pudo acceder a la c√°mara';
                });
        }
        
        function setupVideoStream(stream) {
            // Crear elemento video manualmente
            let videoElement = document.createElement('video');
            videoElement.srcObject = stream;
            videoElement.play();
            
            videoElement.onloadedmetadata = function() {
                console.log('Video metadata cargada');
                video = createCapture(VIDEO);
                video.size(windowWidth, windowHeight);
                video.hide();
                
                startTime = millis();
                classifyVideo();
                document.getElementById('loadingText').style.display = 'none';
            };
        }
        
        function draw() {
            if (!experienceStarted) return;
            
            background(0);
            
            // Mostrar video de fondo
            if (video && video.loadedmetadata) {
                push();
                translate(width, 0);
                scale(-1, 1); // Efecto espejo
                image(video, 0, 0, width, height);
                pop();
            }
            
            // Actualizar estado de detecci√≥n (simulado por ahora)
            simulateDetection();
            
            // Si se detecta la obra, crear meteoritos
            if (isDetected && confidence > 0.7) {
                if (!apocalypseStarted) {
                    apocalypseStarted = true;
                    updateStatus("üå† ¬°APOCALIPSIS ACTIVADO!", true);
                    document.getElementById('instructions').innerHTML = 'üí´ El momento donde la creaci√≥n divina encuentra su fin c√≥smico...';
                }
                
                // Crear nuevos meteoritos
                if (frameCount % 8 == 0) {
                    meteorites.push(new Meteorite());
                }
                
                // Mostrar indicador de meteoritos activo
                if (!document.querySelector('.meteor-indicator')) {
                    let indicator = document.createElement('div');
                    indicator.className = 'meteor-indicator';
                    indicator.innerHTML = '‚òÑÔ∏è';
                    document.body.appendChild(indicator);
                }
                
            } else {
                apocalypseStarted = false;
                // Remover indicador
                let indicator = document.querySelector('.meteor-indicator');
                if (indicator) indicator.remove();
            }
            
            // Actualizar y mostrar meteoritos
            for (let i = meteorites.length - 1; i >= 0; i--) {
                meteorites[i].update();
                meteorites[i].show();
                
                if (meteorites[i].isOffScreen()) {
                    // Crear explosi√≥n al salir
                    explosions.push(new Explosion(meteorites[i].x, height + 50));
                    meteorites.splice(i, 1);
                }
            }
            
            // Actualizar explosiones
            for (let i = explosions.length - 1; i >= 0; i--) {
                explosions[i].update();
                explosions[i].show();
                
                if (explosions[i].isDead()) {
                    explosions.splice(i, 1);
                }
            }
            
            // Mostrar estado de detecci√≥n
            displayDetectionInfo();
        }
        
        // Simulaci√≥n de detecci√≥n por colores caracter√≠sticos de tu obra
        function simulateDetection() {
            if (!video || !video.loadedmetadata) return;
            
            // Analizar colores centrales del video
            let centerX = width / 2;
            let centerY = height / 2;
            
            // Simular detecci√≥n basada en tiempo y movimiento
            let elapsed = millis() - startTime;
            let detectionChance = sin(elapsed * 0.001) * 0.5 + 0.5;
            
            // Simular detecci√≥n cuando hay colores espec√≠ficos
            if (detectionChance > 0.6) {
                label = "La-Extincion-de-Adan";
                confidence = detectionChance;
                isDetected = true;
            } else {
                label = "Buscando...";
                confidence = detectionChance;
                isDetected = false;
            }
            
            updateStatus(`${label} (${(confidence * 100).toFixed(1)}%)`, isDetected);
        }
        
        function classifyVideo() {
            // CUANDO TENGAS EL MODELO LISTO, descomenta estas l√≠neas:
             classifier.classify(video, gotResult);
            
            // Por ahora, usamos la simulaci√≥n
            setTimeout(classifyVideo, 100);
        }
        
        function gotResult(error, results) {
            if (error) {
                console.error(error);
                return;
            }
            
            label = results[0].label;
            confidence = results[0].confidence;
            
            isDetected = (label === "La-Extincion-de-Adan" && confidence > 0.7);
            updateStatus(`${label} (${(confidence * 100).toFixed(1)}%)`, isDetected);
            
            classifyVideo();
        }
        
        function updateStatus(text, detected = false) {
            let statusEl = document.getElementById('status');
            statusEl.textContent = text;
            if (detected) {
                statusEl.classList.add('detected');
            } else {
                statusEl.classList.remove('detected');
            }
        }
        
        function displayDetectionInfo() {
            // Informaci√≥n adicional en pantalla
            if (isDetected) {
                push();
                fill(0, 255, 0, 150);
                stroke(0, 255, 0);
                strokeWeight(3);
                noFill();
                rect(width * 0.1, height * 0.1, width * 0.8, height * 0.8);
                pop();
            }
        }
        
        // Clase Meteorite mejorada
        class Meteorite {
            constructor() {
                // Variar el punto de origen en la esquina superior izquierda
                this.x = random(-50, width * 0.3);
                this.y = random(-50, height * 0.2);
                
                // Punto de destino en esquina inferior derecha
                let targetX = random(width * 0.7, width + 50);
                let targetY = random(height * 0.8, height + 50);
                
                // Calcular velocidad basada en la direcci√≥n
                let angle = atan2(targetY - this.y, targetX - this.x);
                this.speed = random(3, 7);
                this.vx = cos(angle) * this.speed;
                this.vy = sin(angle) * this.speed;
                
                this.size = random(8, 20);
                this.rotation = random(TWO_PI);
                this.rotationSpeed = random(-0.2, 0.2);
                this.trail = [];
                this.maxTrailLength = random(8, 15);
                
                // Color del meteorito
                this.color = {
                    r: random(200, 255),
                    g: random(50, 150),
                    b: random(0, 50)
                };
            }
            
            update() {
                this.x += this.vx;
                this.y += this.vy;
                this.rotation += this.rotationSpeed;
                
                // Agregar posici√≥n al trail
                this.trail.push({ x: this.x, y: this.y });
                if (this.trail.length > this.maxTrailLength) {
                    this.trail.splice(0, 1);
                }
            }
            
            show() {
                // Dibujar estela
                for (let i = 0; i < this.trail.length; i++) {
                    let alpha = map(i, 0, this.trail.length, 0, 200);
                    let size = map(i, 0, this.trail.length, this.size * 0.2, this.size * 0.8);
                    
                    push();
                    fill(this.color.r, this.color.g + 50, 0, alpha);
                    noStroke();
                    ellipse(this.trail[i].x, this.trail[i].y, size);
                    pop();
                }
                
                // Dibujar meteorito principal
                push();
                translate(this.x, this.y);
                rotate(this.rotation);
                
                // N√∫cleo brillante
                fill(this.color.r, this.color.g + 100, this.color.b + 100);
                noStroke();
                ellipse(0, 0, this.size);
                
                // Borde exterior
                fill(this.color.r, this.color.g, this.color.b);
                ellipse(0, 0, this.size * 0.7);
                
                // Brillo interior
                fill(255, 255, 200, 150);
                ellipse(-this.size * 0.2, -this.size * 0.2, this.size * 0.3);
                
                pop();
            }
            
            isOffScreen() {
                return (this.x > width + 100 || this.y > height + 100);
            }
        }
        
        // Clase para explosiones al final
        class Explosion {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.particles = [];
                this.life = 60;
                
                // Crear part√≠culas de explosi√≥n
                for (let i = 0; i < 12; i++) {
                    this.particles.push({
                        x: x,
                        y: y,
                        vx: random(-3, 3),
                        vy: random(-3, 3),
                        size: random(3, 8),
                        life: random(30, 60),
                        maxLife: random(30, 60)
                    });
                }
            }
            
            update() {
                this.life--;
                
                for (let particle of this.particles) {
                    particle.x += particle.vx;
                    particle.y += particle.vy;
                    particle.life--;
                    particle.size *= 0.98;
                }
            }
            
            show() {
                for (let particle of this.particles) {
                    if (particle.life > 0) {
                        let alpha = map(particle.life, 0, particle.maxLife, 0, 255);
                        push();
                        fill(255, 100, 0, alpha);
                        noStroke();
                        ellipse(particle.x, particle.y, particle.size);
                        pop();
                    }
                }
            }
            
            isDead() {
                return this.life <= 0;
            }
        }
        
        // Responsive
        function windowResized() {
            resizeCanvas(windowWidth, windowHeight);
            if (video) {
                video.size(windowWidth, windowHeight);
            }
        }
    </script>
</body>
</html>
